<%
bp = @blueprint
# binding.pry 
-%>{
  "provider": {
    "aws": {
      "region": "<%= @context.target.provider.aws_region %>"
    }
  },
  "provider": {
    "aws": {
      "region": "us-east-1",
      "alias": "us-east-1"
    }
    <%# NOTE: the MODULES should be a method on the @blueprint instance %>
  }<% Blueprint::Aws::Instance::MODULES.each_with_index do |key, index|
  next unless bp.send(key)
  -%><%= ",\n\"module\":" + JSON.pretty_generate({ key => { 'source' => source }.merge(bp.send(key)).transform_values { |v| v.is_a?(String) ? v.cnfs_sub : v }.sort.to_h }) %>
<% end %>
}
